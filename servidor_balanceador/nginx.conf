# nginx.conf

worker_processes auto;

# Manejo de eventos y conexiones simultáneas
events {
    worker_connections 1024; # Número máximo de conexiones simultáneas por trabajador
}

http {
    # Activar el log de acceso
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    # Ajustar tiempo de espera
    keepalive_timeout 65;

    # Configuración del grupo de servidores backend
    upstream backend {
        server 192.168.10.11:80; # Servidor 1
        server 192.168.10.12:80; # Servidor 2
        # Opción: añadir peso o parámetros adicionales
        # server 192.168.10.11:80 weight=2; 
    }

    # Configuración del servidor principal para el balanceador
    server {
        listen 80;
        server_name balanceador.local; # Nombre del balanceador (opcional)

        # Configuración de balanceo de carga
        location / {
            proxy_pass http://backend; # Dirección del upstream
            proxy_set_header Host $host; # Encabezado Host para la solicitud
            proxy_set_header X-Real-IP $remote_addr; # Dirección IP del cliente
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # Proxies previos
            proxy_set_header X-Forwarded-Proto $scheme; # Protocolo (http o https)

            # Opcional: configurar caché
            proxy_cache_bypass $http_cache_control;
        }
    }

    # Opcional: Bloque para manejar errores
    server {
        listen 80;
        server_name balanceador.local;
        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
            root /usr/share/nginx/html;
        }
    }
}
